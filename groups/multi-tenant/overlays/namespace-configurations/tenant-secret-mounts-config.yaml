apiVersion: redhatcop.redhat.io/v1alpha1
kind: NamespaceConfig
metadata:
  name: tenant-secret-mounts
spec:
  labelSelector:
    matchExpressions:
      - key: team
        operator: Exists
      - key: application
        operator: Exists        
  templates:     
    - objectTemplate: |
        apiVersion: redhatcop.redhat.io/v1alpha1
        kind: SecretEngineMount
        metadata:
          name: static-secrets-{{ .Name }}
          namespace: vault-admin
        spec:
          authentication: 
            path: ${CLUSTER_NAME}
            role: vault-admin
            serviceAccount:
              name: default
          name: static-secrets                
          type: kv
          path: /applications/{{ .Labels.team }}/{{ .Name }} 
      excludedPaths:
        - .metadata
        - .status
        - .spec.replicas
        - .spec.config
        - .spec.externalEntropyAccess
        - .spec.local
        - .spec.sealWrap                                     